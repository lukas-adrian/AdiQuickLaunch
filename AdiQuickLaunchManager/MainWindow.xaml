<Window x:Class="AdiQuickLaunchManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="AdiQuickLauncher Manager" Height="500" Width="800"
        xmlns:converter="clr-namespace:AdiQuickLaunchLib.Converter;assembly=AdiQuickLaunchLib"
        Icon="/Assets/icon.ico"
        Closing="MainWindow_Closing">
   
   <Window.Resources>
      <converter:BooleanToVisibilityConverter x:Key="converter:BooleanToVisibilityConverter"/>
      <converter:InvertBooleanToVisibilityConverter x:Key="converter:InvertBooleanToVisibilityConverter"/>

      <!-- Style for the inline TextBox editor (uses EventSetters) -->
      <Style x:Key="InlineEditorTextBoxStyle" TargetType="TextBox">
         <Setter Property="MinHeight" Value="24"/>
         <Setter Property="Padding" Value="4,2"/>
         <Setter Property="VerticalAlignment" Value="Center"/>
         <EventSetter Event="Loaded" Handler="EditorTextBox_Loaded"/>
         <EventSetter Event="KeyDown" Handler="EditorTextBox_KeyDown"/>
         <EventSetter Event="LostFocus" Handler="EditorTextBox_LostFocus"/>
      </Style>
   </Window.Resources>

   <Grid Background="#1E1E1E">
      <Grid.ColumnDefinitions>
         <ColumnDefinition Width="68.354"/>
         <ColumnDefinition Width="231.646"/>
         <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Left Panel - Launchers -->
      <Border Grid.Column="0" Background="#252526" Margin="10,10,10,10" Grid.ColumnSpan="2">
         <Grid Margin="15">
            <Grid.RowDefinitions>
               <RowDefinition Height="Auto"/>
               <!-- Title -->
               <RowDefinition Height="*"/>
               <!-- ListBox fills all remaining -->
               <RowDefinition Height="Auto"/>
               <!-- Button at bottom -->
            </Grid.RowDefinitions>

            <!-- Title -->
            <TextBlock Text="Quick Launchers"
                   Foreground="White"
                   FontSize="16"
                   FontWeight="Bold"
                   Margin="0,0,0,10"/>

            <!-- List -->
            <ListBox x:Name="LaunchersList"
                 Grid.Row="1"
                 ItemsSource="{Binding Launchers}"
                 Background="Transparent"
                 BorderThickness="0"
                 Foreground="White">

               <!-- ItemContainerStyle -->
               <ListBox.ItemContainerStyle>
                  <Style TargetType="ListBoxItem">
                     <Setter Property="VerticalContentAlignment" Value="Center"/>
                     <Setter Property="Padding" Value="2"/>
                  </Style>
               </ListBox.ItemContainerStyle>

               <!-- Template -->
               <ListBox.ItemTemplate>
                  <DataTemplate>
                     <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Image Source="{Binding IconPath}"
                               Width="20" Height="20"
                               Margin="0,0,8,0"/>
                        <ContentControl>
                           <ContentControl.Style>
                              <Style TargetType="ContentControl">
                                 <Setter Property="Content">
                                    <Setter.Value>
                                       <TextBlock Text="{Binding Name}"
                                                       VerticalAlignment="Center"
                                                       Padding="4,2"/>
                                    </Setter.Value>
                                 </Setter>
                                 <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                       <Setter Property="Content">
                                          <Setter.Value>
                                             <TextBox Style="{StaticResource InlineEditorTextBoxStyle}"
                                                             Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                                          </Setter.Value>
                                       </Setter>
                                    </DataTrigger>
                                 </Style.Triggers>
                              </Style>
                           </ContentControl.Style>
                        </ContentControl>
                     </StackPanel>
                  </DataTemplate>
               </ListBox.ItemTemplate>
            </ListBox>

            <!-- Add button pinned to bottom -->
            <Button Grid.Row="2"
                Content="+ Add Launcher"
                Click="AddLauncher_Click"
                Background="#007ACC"
                Foreground="White"
                BorderThickness="0"
                Padding="15,8"
                FontWeight="Bold"
                Cursor="Hand"/>
         </Grid>
      </Border>


      <!-- Right Panel - Folders -->
      <Border Grid.Column="2" Background="#252526" Margin="10,10,10,10">
         <Grid Margin="15">
            <Grid.RowDefinitions>
               <RowDefinition Height="Auto"/>
               <!-- Title + Icon -->
               <RowDefinition Height="*"/>
               <!-- Folder list fills -->
               <RowDefinition Height="Auto"/>
               <!-- Buttons -->
            </Grid.RowDefinitions>

            <!-- Title + Icon area -->
            <StackPanel Grid.Row="0"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Margin="0,0,0,10">
               <Image Source="{Binding SelectedItem.IconPath, ElementName=LaunchersList}"
                      Width="48" Height="48"
                      Margin="0,0,10,0"/>
               <TextBlock Text="Folders"
                          Foreground="White"
                          FontSize="20"
                          FontWeight="Bold"
                          VerticalAlignment="Center"/>
            </StackPanel>


            <!-- Item/Folder List -->
            <ListBox x:Name="FoldersList"
                     Grid.Row="1"
                     ItemsSource="{Binding SelectedItem.Items, ElementName=LaunchersList}"
                     Background="Transparent"
                     BorderThickness="0"
                     Foreground="White">
               
               <ListBox.Resources>
                  <converter:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
                  <converter:InvertBooleanToVisibilityConverter x:Key="InvertBooleanToVisibilityConverter"/>

                  <Style x:Key="NameDisplayStyle" TargetType="{x:Type TextBlock}">
                     <Setter Property="Foreground" Value="White"/>
                     <Setter Property="FontWeight" Value="Bold"/>
                     <Setter Property="VerticalAlignment" Value="Center"/>
                  </Style>
        
                  <Style x:Key="NameEditStyle" TargetType="{x:Type TextBox}">
                     <Setter Property="FontWeight" Value="Bold"/>
                     <Setter Property="VerticalAlignment" Value="Center"/>
    
                     <Setter Property="Background" Value="White"/> 
    
                     <Setter Property="Foreground" Value="Black"/> 
    
                     <Setter Property="BorderThickness" Value="0"/>
                     <Setter Property="Padding" Value="0"/>
    
                     <Setter Property="Template">
                        <Setter.Value>
                           <ControlTemplate TargetType="{x:Type TextBox}">
                              <Border Background="{TemplateBinding Background}"
                                      BorderBrush="{TemplateBinding BorderBrush}"
                                      BorderThickness="{TemplateBinding BorderThickness}">
                                 <ScrollViewer x:Name="PART_ContentHost"/>
                              </Border>
                           </ControlTemplate>
                        </Setter.Value>
                     </Setter>
                  </Style>
               </ListBox.Resources>
               
               <ListBox.ItemTemplate>
                  <DataTemplate>
                     <StackPanel Orientation="Horizontal" Margin="0,2">
                
                        <Image Source="{Binding IconSource}" 
                               Width="16" Height="16" 
                               VerticalAlignment="Center"
                               Margin="0,0,8,0"/>

                        <Grid Margin="0,0,10,0" VerticalAlignment="Center">
                           <TextBlock Text="{Binding Name}" 
                                      FontWeight="Bold"
                                      Style="{StaticResource NameDisplayStyle}"
                                      Visibility="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected, Converter={StaticResource InvertBooleanToVisibilityConverter}}"/>

                           <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                    FontWeight="Bold" 
                                    Style="{StaticResource NameEditStyle}"
                                    Visibility="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        </Grid>

                        <TextBlock Text="{Binding Path}" 
                                   VerticalAlignment="Center" 
                                   Opacity="0.7"/>
                     </StackPanel>
                  </DataTemplate>
               </ListBox.ItemTemplate>
            </ListBox>

            <!-- Buttons at bottom -->
            <StackPanel Grid.Row="2" Margin="0,10,0,0">
               <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                  <Button Content="📄 Add Item"
                        Click="AddItem_Click"
                        Background="#28A745"
                        Foreground="White"
                        BorderThickness="0"
                        Padding="12,8"
                        Margin="0,0,5,0"/>
                  <Button Content="📁 Add Folder"
                          Click="AddFolder_Click"
                          Background="#28A745"
                          Foreground="White"
                          BorderThickness="0"
                          Padding="12,8"
                          Margin="0,0,5,0"/>
                  <Button Content="🗑️ Remove"
                        Click="RemoveFolder_Click"
                        Background="#DC3545"
                        Foreground="White"
                        BorderThickness="0"
                        Padding="12,8"/>
               </StackPanel>

               <Button Content="🖼️ Change Icon"
                    Click="ChangeIcon_Click"
                    Background="#17A2B8"
                    Foreground="White"
                    BorderThickness="0"
                    Padding="12,8"
                    Margin="0,5,0,0"/>

               <Button Content="🚀 Create Link on Desktop"
                    Click="CreateLauncher_Click"
                    Background="#FFC107"
                    Foreground="Black"
                    BorderThickness="0"
                    Padding="15,10"
                    FontWeight="Bold"
                    Margin="0,5,0,0"/>
            </StackPanel>
         </Grid>
      </Border>
   </Grid>
</Window>
